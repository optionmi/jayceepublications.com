document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",g);var d,u;function g(t){d=t.target.closest("[data-delete-route]"),d&&(t.preventDefault(),u=d.dataset.deleteRoute)}const h=document.getElementById("confirmDeleteBtn");h&&h.addEventListener("click",()=>{p()});const f=document.getElementById("confirmDemoteBtn");f&&f.addEventListener("click",()=>{console.log("h"),p()});function p(){fetch(u,{method:"delete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).then(t=>t.json()).then(t=>{t.error==!0?toastr.error(t.message,"Admin Panel"):toastr.success(t.message,"Admin Panel")}),d.parentElement.parentElement.parentElement.remove()}document.addEventListener("click",function(t){const e=t.target.closest("[data-row-data]")||t.target.closest("[data-restricted-permissions]");if(!e)return;t.preventDefault();const n=e.dataset.updateRoute;let r;e.dataset.rowData&&(r=JSON.parse(e.dataset.rowData));let o;e.dataset.selectOptions&&(o=JSON.parse(e.dataset.selectOptions));let s;e.dataset.restrictedPermissions&&(s=JSON.parse(e.dataset.restrictedPermissions)),document.getElementById("updateDataForm").setAttribute("action",n),Array.from(document.querySelectorAll(".updateDataField")).forEach((a,i)=>{a.value=r[i]}),Array.from(document.querySelectorAll(".selectOptions")).forEach((a,i)=>{for(;a.firstChild;)a.removeChild(a.firstChild);if(o[i].length>0)o[i].forEach(l=>{const m=document.createElement("option");m.value=l.id,m.textContent=l.name,a.appendChild(m)});else{const l=document.createElement("option");l.value="",l.textContent="No topics found for this category!",a.appendChild(l)}}),s&&Array.from(document.querySelectorAll(".permissionCheckBox")).forEach((a,i)=>{a.checked=!s.includes(parseInt(a.value))})}),$("#enableArticlesForm input").on("change",function(){const t=$(this).closest("form"),e=t.attr("action"),n=t.attr("method"),r=new FormData(t[0]);r.append("enableArticles",$(this).is(":checked")),fetch(e,{method:n,body:r}).then(o=>o.json()).then(o=>{o.error==!0?toastr.error(o.message,"Admin Panel"):toastr.success(o.message,"Admin Panel")})}),$("form").on("submit",function(t){$("#loading").toggleClass("d-none"),$("body").css("overflow","hidden"),t.preventDefault();const e=$(this),n=e.attr("action"),r=e.attr("method"),o=e.attr("reload"),s=new FormData(this);$.ajax({url:n,type:r,data:s,contentType:!1,processData:!1,success:function(c){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),c.error==!0?toastr.error(c.message,"Admin Panel"):(toastr.success(c.message,"Admin Panel"),e.parents(".modal").length>0&&(e[0].reset(),document.querySelectorAll('form input[type="hidden"]').forEach(i=>{i.name!=="_token"&&(i.value="")})),$(".modal").modal("hide"),o=="true"&&location.reload(),$(".dataTable").DataTable().draw())},error:function(c){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),toastr.error("Something went wrong!","Admin Panel"),console.error("Error:",c)}})}),$(".modal").on("hide.coreui.modal",function(){$(this).find("form").trigger("reset"),document.querySelectorAll('form input[type="hidden"]').forEach(e=>{e.name!=="_token"&&(e.value="")})}),$("[data-table-route]").each(function(t){const n=$(this).attr("data-table-route"),r=$(this).find("th").map(function(o,s){return{data:$(this).text()==="#"?"serial":$(this).text()==="Category"?"category_title":$(this).text()==="Group"?"group_title":$(this).text()==="Topic"?"topic_name":$(this).text()==="Categories"?"categories_names":$(this).text()==="Media"?"media_file":$(this).text().toLowerCase(),name:$(this).text(),searchable:$(this).text()!=="#"&&$(this).text()!=="Actions",orderable:$(this).text()!=="Actions",defaultContent:"NA"}});$("[data-table-route]").DataTable({language:{zeroRecords:"No record(s) found."},processing:!0,serverSide:!0,lengthChange:!0,order:[0,"asc"],searchable:!0,bStateSave:!1,ajax:{url:n,data:function(o){}},columns:r})}),$(document).on("click","[data-btn-route]",function(t){const e=$(this).data("btn-route");fetch(e).then(n=>n.json()).then(n=>{n.error==!0?toastr.error(n.message,"Admin Panel"):toastr.success(n.message,"Admin Panel")})}),$("#categoryPostCategory").on("change",function(){const e=$(this).find("option:selected").data("topics-route"),n=document.getElementById("categoryPostTopic");for(;n.firstChild;)n.removeChild(n.firstChild);fetch(e).then(r=>r.json()).then(r=>{if(r.length>0)r.forEach(o=>{const s=document.createElement("option");s.value=o.id,s.textContent=o.name,n.appendChild(s)});else{const o=document.createElement("option");o.value="",o.textContent="No topics found for this category!",n.appendChild(o)}})})});
