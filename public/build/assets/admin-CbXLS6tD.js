document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",g);var d,m;function g(t){d=t.target.closest("[data-delete-route]"),d&&(t.preventDefault(),m=d.dataset.deleteRoute)}const f=document.getElementById("confirmDeleteBtn");f&&f.addEventListener("click",()=>{p()});const h=document.getElementById("confirmDemoteBtn");h&&h.addEventListener("click",()=>{console.log("h"),p()});function p(){fetch(m,{method:"delete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).then(t=>t.json()).then(t=>{t.error==!0?toastr.error(t.message,"Admin Panel"):toastr.success(t.message,"Admin Panel")}),d.parentElement.parentElement.parentElement.remove()}document.addEventListener("click",function(t){const e=t.target.closest("[data-row-data]")||t.target.closest("[data-restricted-permissions]");if(!e)return;t.preventDefault();const o=e.dataset.updateRoute;let a;e.dataset.rowData&&(a=JSON.parse(e.dataset.rowData));let n;e.dataset.selectOptions&&(n=JSON.parse(e.dataset.selectOptions));let s;e.dataset.restrictedPermissions&&(s=JSON.parse(e.dataset.restrictedPermissions)),document.getElementById("updateDataForm").setAttribute("action",o),Array.from(document.querySelectorAll(".updateDataField")).forEach((r,i)=>{r.value=a[i]}),Array.from(document.querySelectorAll(".selectOptions")).forEach((r,i)=>{for(;r.firstChild;)r.removeChild(r.firstChild);if(n[i].length>0)n[i].forEach(l=>{const u=document.createElement("option");u.value=l.id,u.textContent=l.name,r.appendChild(u)});else{const l=document.createElement("option");l.value="",l.textContent="No topics found for this category!",r.appendChild(l)}}),s&&Array.from(document.querySelectorAll(".permissionCheckBox")).forEach((r,i)=>{r.checked=!s.includes(parseInt(r.value))})}),$("#enableArticlesForm input").on("change",function(){}),$("form").on("submit",function(t){$("#loading").toggleClass("d-none"),$("body").css("overflow","hidden"),t.preventDefault();const e=$(this),o=e.attr("action"),a=e.attr("method"),n=e.attr("reload"),s=new FormData(this);$.ajax({url:o,type:a,data:s,contentType:!1,processData:!1,success:function(c){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),c.error==!0?toastr.error(c.message,"Admin Panel"):(toastr.success(c.message,"Admin Panel"),e.parents(".modal").length>0&&(e[0].reset(),document.querySelectorAll('form input[type="hidden"]').forEach(i=>{i.name!=="_token"&&(i.value="")})),$(".modal").modal("hide"),n=="true"&&location.reload(),$(".dataTable").DataTable().draw())},error:function(c){$("#loading").toggleClass("d-none"),$("body").css("overflow","auto"),toastr.error("Something went wrong!","Admin Panel"),console.error("Error:",c)}})}),$(".modal").on("hide.coreui.modal",function(){$(this).find("form").trigger("reset"),document.querySelectorAll('form input[type="hidden"]').forEach(e=>{e.name!=="_token"&&(e.value="")})}),$("[data-table-route]").each(function(t){const o=$(this).attr("data-table-route"),a=$(this).find("th").map(function(n,s){return{data:$(this).text()==="#"?"serial":$(this).text()==="Category"?"category_title":$(this).text()==="Group"?"group_title":$(this).text()==="Topic"?"topic_name":$(this).text()==="Categories"?"categories_names":$(this).text()==="Media"?"media_file":$(this).text().toLowerCase(),name:$(this).text(),searchable:$(this).text()!=="#"&&$(this).text()!=="Actions",orderable:$(this).text()!=="Actions",defaultContent:"NA"}});$("[data-table-route]").DataTable({language:{zeroRecords:"No record(s) found."},processing:!0,serverSide:!0,lengthChange:!0,order:[0,"asc"],searchable:!0,bStateSave:!1,ajax:{url:o,data:function(n){}},columns:a})}),$(document).on("click","[data-btn-route]",function(t){const e=$(this).data("btn-route");fetch(e).then(o=>o.json()).then(o=>{o.error==!0?toastr.error(o.message,"Admin Panel"):toastr.success(o.message,"Admin Panel")})}),$("#categoryPostCategory").on("change",function(){const e=$(this).find("option:selected").data("topics-route"),o=document.getElementById("categoryPostTopic");for(;o.firstChild;)o.removeChild(o.firstChild);fetch(e).then(a=>a.json()).then(a=>{if(a.length>0)a.forEach(n=>{const s=document.createElement("option");s.value=n.id,s.textContent=n.name,o.appendChild(s)});else{const n=document.createElement("option");n.value="",n.textContent="No topics found for this category!",o.appendChild(n)}})})});
